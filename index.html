<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reserva de Aniversário • Mercatto Delícia</title>
  <style>
    :root{
      --bg:#0a0a0a;
      --panel:#111214;
      --line:#292929;
      --text:#f8f7f4;
      --muted:#cfc8b0;
      --brand:#d4af37;
      --brand-2:#f5d26a;
      --ok:#16a34a; --danger:#ef4444;
    }

    *{box-sizing:border-box}
    html,body{margin:0;height:100%;color:var(--text);font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif}
    a{color:inherit}

    body{background:url('https://github.com/ClenaStore/aniversarios/raw/main/pages/api/Imagem%20do%20WhatsApp%20de%202025-08-27%20%C3%A0(s)%2015.21.11_b5d8c770.jpg') no-repeat center top;background-size:cover;}

    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:-1}

    .container{max-width:420px;margin:0;position:absolute;top:20%;left:5%;}

    .card{background:rgba(17,18,20,.92);border-radius:16px;padding:16px;width:100%}
    .section-title{font-size:18px;font-weight:800;margin-bottom:10px;color:var(--brand-2)}

    form{display:grid;gap:10px}
    label{font-size:12px;color:var(--muted)}
    input,textarea,button{font:inherit}
    input,textarea{width:100%;background:#0c0d0f;border:1px solid var(--line);color:var(--text);padding:10px;border-radius:10px;outline:none}
    input:focus,textarea:focus{border-color:var(--brand);box-shadow:0 0 0 2px rgba(212,175,55,.18)}
    textarea{min-height:80px;resize:vertical}

    .btn{cursor:pointer;border:0;border-radius:999px;padding:12px 16px;font-weight:700;letter-spacing:.3px}
    .btn-primary{background:linear-gradient(180deg,var(--brand),#c79b1d);color:#1a1500;border:1px solid #d0a62d}
    .btn-line{background:transparent;border:1px solid var(--line);color:var(--text)}

    .rules{background:rgba(17,18,20,.9);padding:14px;border-radius:12px;max-width:420px;position:absolute;bottom:5%;left:5%}
    .rules h2{font-size:16px;color:var(--brand-2);margin-top:0}
    .rules p,.rules li{font-size:13px;color:var(--muted);margin:4px 0}
  </style>
</head>
<body>
  <div class="overlay"></div>

  <div class="container">
    <div class="card">
      <div class="section-title">Faça sua reserva</div>
      <form id="formReserva">
        <div>
          <label>Nome completo</label>
          <input id="nome" placeholder="Seu nome" required />
        </div>
        <div>
          <label>Email</label>
          <input id="email" type="email" placeholder="seu@email.com" />
        </div>
        <div>
          <label>Telefone (com DDD)</label>
          <input id="telefone" inputmode="tel" placeholder="(99) 99999-9999" required />
        </div>
        <div>
          <label>Quantidade de pessoas</label>
          <input id="pessoas" type="number" inputmode="numeric" min="1" max="50" placeholder="ex.: 4" required />
        </div>
        <div>
          <label>Data</label>
          <input id="data" type="date" required />
        </div>
        <div>
          <label>Hora</label>
          <input id="hora" type="time" required />
        </div>
        <div>
          <label>Nº da mesa (opcional)</label>
          <input id="mesa" placeholder="ex.: 12" />
        </div>
        <div>
          <label>Observações (opcional)</label>
          <textarea id="observacoes" placeholder="Ex.: Preferência por mesa externa, levar bolo, etc."></textarea>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="btnReservar" class="btn btn-primary" type="submit">Reservar agora</button>
          <a id="btnAtendente" class="btn btn-line" href="#" target="_blank" rel="noopener">Falar com atendente</a>
        </div>
        <div id="msg" style="margin-top:10px"></div>
      </form>
    </div>
  </div>

  <section class="rules">
    <h2>Regras</h2>
    <p>Válido apenas no mês do aniversário (com documento). Exclusivo para consumo no local. Um benefício por aniversariante.</p>
    <h2>Exemplos de desconto</h2>
    <ul>
      <li>R$ 100 → R$ 20 de desconto</li>
      <li>R$ 200 → R$ 40 de desconto</li>
      <li>R$ 300 → R$ 60 de desconto</li>
      <li>R$ 500 ou mais → R$ 100 de desconto (limite)</li>
    </ul>
  </section>

<script>
  const CONFIG = {
    SHEET_ENDPOINT: "https://script.google.com/macros/s/SEU_SCRIPT_ID/exec",
    ATENDENTE_WHATS: "5599999999999",
    ATENDENTE_MSG: "Olá! Gostaria de falar com um atendente sobre reserva de aniversário.",
    EMPRESA: "MERCATTO DELÍCIA"
  };

  const $ = sel => document.querySelector(sel);
  function normalizePhoneBR(p){
    let raw = String(p||'').replace(/\D+/g,'');
    if (!raw) return '';
    raw = raw.replace(/^0+/, '');
    if (!raw.startsWith('55')) raw = '55' + raw;
    if (raw.length===12){ const ddd = raw.slice(2,4); const local = raw.slice(4); raw = '55'+ddd+'9'+local; }
    return raw;
  }
  function buildWhatsLink(phoneDigits, text){
    const encoded = encodeURIComponent(text).replace(/%0D%0A|%0D/g, '%0A');
    const ua = navigator.userAgent||'';
    const isMobile = /Android|iPhone|iPad|iPod|Mobile|WhatsApp/i.test(ua);
    if (isMobile) return `whatsapp://send?phone=${phoneDigits}&text=${encoded}`;
    return `https://web.whatsapp.com/send?phone=${phoneDigits}&text=${encoded}`;
  }

  $('#formReserva').addEventListener('submit', async (ev)=>{
    ev.preventDefault();
    const btn = $('#btnReservar');
    const msg = $('#msg'); msg.textContent=''; msg.className='';

    const nome = $('#nome').value.trim();
    const email = $('#email').value.trim();
    const telefone = normalizePhoneBR($('#telefone').value);
    const pessoas = $('#pessoas').value.trim();
    const mesa = $('#mesa').value.trim();
    const data = $('#data').value;
    const hora = $('#hora').value;
    const observacoes = $('#observacoes').value.trim();

    if (!nome || !telefone || !pessoas || !data || !hora){
      msg.textContent = 'Preencha os campos obrigatórios.';
      msg.className = 'error';
      return;
    }

    const id = 'R'+Date.now().toString(36)+Math.random().toString(36).slice(2,7).toUpperCase();
    const carimbo = new Date().toISOString();
    const dataHoraISO = new Date(`${data}T${hora}:00`).toISOString();

    const payload = {
      ID: id,
      Carimbo: carimbo,
      Nome: nome,
      Email: email,
      Telefone: telefone,
      Pessoas: pessoas,
      Mesa: mesa,
      DataHora: dataHoraISO,
      Status: 'Pendente',
      Observacoes: observacoes
    };

    btn.disabled = true; btn.textContent = 'Enviando…';
    try{
      const r = await fetch(CONFIG.SHEET_ENDPOINT,{
        method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)
      });
      if (r.ok){
        msg.innerHTML = `<div class="success"><b>Reserva enviada!</b><br>Protocolo: <b>${id}</b>.</div>`;
        $('#formReserva').reset();
      }else{
        throw new Error('Falha ao enviar');
      }
    }catch(err){
      console.error(err);
      msg.innerHTML = `<div class="error">Não foi possível enviar sua reserva agora.</div>`;
    }finally{
      btn.disabled = false; btn.textContent = 'Reservar agora';
    }
  });
</script>
</body>
</html>
