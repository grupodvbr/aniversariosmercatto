<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reserva de Aniversário • Mercatto Delícia</title>
  <style>
    :root{
      --panel:#111214;
      --line:#292929;
      --text:#f8f7f4;
      --muted:#cfc8b0;
      --brand:#d4af37;
      --brand-2:#f5d26a;
      --ok:#16a34a;
      --danger:#ef4444;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif;
      color:var(--text);
      background:#000;
    }

    /* HERO COM IMAGEM */
    .hero{
      position:relative;
      background:url('https://github.com/grupodvbr/aniversariosmercatto/blob/main/paste/Imagem%20do%20WhatsApp%20de%202025-08-27%20%C3%A0(s)%2015.21.11_b5d8c770.jpg?raw=true') no-repeat center top;
      background-size:cover;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:flex-start;
      padding:20px;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:0;
      background:rgba(0,0,0,.3);
    }

    /* PAINEL DE RESERVA */
    .form-box{
      position:relative;
      background:rgba(17,18,20,.92);
      border-radius:14px;
      padding:18px;
      width:100%;
      max-width:280px;
      z-index:1;
    }
    .section-title{font-size:16px;font-weight:800;margin-bottom:12px;color:var(--brand-2)}

    form{display:grid;gap:10px}
    label{font-size:12px;color:var(--muted)}
    input,textarea,button{font:inherit}
    input,textarea{
      width:100%;
      background:#0c0d0f;
      border:1px solid var(--line);
      color:var(--text);
      padding:10px;
      border-radius:10px;
      outline:none;
      font-size:14px;
    }
    textarea{min-height:60px;resize:vertical}
    input:focus,textarea:focus{
      border-color:var(--brand);
      box-shadow:0 0 0 2px rgba(212,175,55,.2)
    }

    .btn{cursor:pointer;border:0;border-radius:999px;padding:12px;font-weight:700}
    .btn-primary{background:linear-gradient(180deg,var(--brand),#c79b1d);color:#1a1500;border:1px solid #d0a62d}
    .btn-line{background:transparent;border:1px solid var(--line);color:var(--text)}
    .success{background:rgba(22,163,74,.15);color:#a6f3b5;padding:10px;border-radius:8px;font-size:14px}
    .error{background:rgba(239,68,68,.15);color:#ffc6c6;padding:10px;border-radius:8px;font-size:14px}

    /* BLOCOS DE REGRAS */
    .rules{
      background:#111214;
      padding:20px;
      border-top:1px solid #222;
    }
    .rules h3{margin-top:0;color:var(--brand-2)}
    .rules ul{margin:0;padding-left:18px}
    .rules li{margin:6px 0}

    /* RESPONSIVO */
    @media(max-width:768px){
      .hero{justify-content:center;padding:10px}
      .form-box{max-width:90%}
    }
  </style>
</head>
<body>
  <!-- HERO COM FORMULÁRIO -->
  <section class="hero">
    <div class="form-box">
      <div class="section-title">Faça sua reserva</div>
      <form id="formReserva">
        <div>
          <label>Nome completo</label>
          <input id="nome" placeholder="Seu nome" required />
        </div>
        <div>
          <label>Email</label>
          <input id="email" type="email" placeholder="seu@email.com" />
        </div>
        <div>
          <label>Telefone (com DDD)</label>
          <input id="telefone" inputmode="tel" placeholder="(99) 99999-9999" required />
        </div>
        <div>
          <label>Quantidade de pessoas</label>
          <input id="pessoas" type="number" min="1" max="50" placeholder="ex.: 4" required />
        </div>
        <div>
          <label>Data</label>
          <input id="data" type="date" required />
        </div>
        <div>
          <label>Hora</label>
          <input id="hora" type="time" required />
        </div>
        <div>
          <label>Nº da mesa (opcional)</label>
          <input id="mesa" placeholder="ex.: 12" />
        </div>
        <div>
          <label>Observações (opcional)</label>
          <textarea id="observacoes" placeholder="Ex.: Preferência por mesa externa, levar bolo, etc."></textarea>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="btnReservar" class="btn btn-primary" type="submit">Reservar agora</button>
          <a id="btnAtendente" class="btn btn-line" href="#" target="_blank" rel="noopener">Falar com atendente</a>
        </div>
        <div id="msg" style="margin-top:10px"></div>
      </form>
    </div>
  </section>

  <!-- BLOCO REGRAS -->
  <section class="rules">
    <h3>Regras</h3>
    <p>Válido apenas no mês do aniversário (com documento). Exclusivo para consumo no local. Um benefício por aniversariante.</p>
  </section>

  <!-- BLOCO EXEMPLOS -->
  <section class="rules">
    <h3>Exemplos de desconto</h3>
    <ul>
      <li>R$ 100 → R$ 20 de desconto</li>
      <li>R$ 200 → R$ 40 de desconto</li>
      <li>R$ 300 → R$ 60 de desconto</li>
      <li>R$ 500 ou mais → R$ 100 de desconto (limite)</li>
    </ul>
  </section>

<script>
  const CONFIG = {
    SHEET_ENDPOINT: "https://script.google.com/macros/s/SEU_SCRIPT_ID/exec",
    ATENDENTE_WHATS: "5599999999999",
    ATENDENTE_MSG: "Olá! Gostaria de falar com um atendente sobre reserva de aniversário."
  };

  const $ = sel => document.querySelector(sel);

  function normalizePhoneBR(p){
    let raw = String(p||'').replace(/\D+/g,'');
    if (!raw) return '';
    raw = raw.replace(/^0+/, '');
    if (!raw.startsWith('55')) raw = '55' + raw;
    if (raw.length===12){ const ddd = raw.slice(2,4); const local = raw.slice(4); raw = '55'+ddd+'9'+local; }
    return raw;
  }
  function buildWhatsLink(phoneDigits, text){
    const encoded = encodeURIComponent(text).replace(/%0D%0A|%0D/g, '%0A');
    const ua = navigator.userAgent||'';
    const isMobile = /Android|iPhone|iPad|iPod|Mobile|WhatsApp/i.test(ua);
    if (isMobile) return `whatsapp://send?phone=${phoneDigits}&text=${encoded}`;
    return `https://web.whatsapp.com/send?phone=${phoneDigits}&text=${encoded}`;
  }

  // Atualiza link do atendente
  $('#btnAtendente').href = buildWhatsLink(CONFIG.ATENDENTE_WHATS, CONFIG.ATENDENTE_MSG);

  // Envio do formulário
  $('#formReserva').addEventListener('submit', async (ev)=>{
    ev.preventDefault();
    const btn = $('#btnReservar');
    const msg = $('#msg'); msg.textContent=''; msg.className='';

    const nome = $('#nome').value.trim();
    const email = $('#email').value.trim();
    const telefone = normalizePhoneBR($('#telefone').value);
    const pessoas = $('#pessoas').value.trim();
    const mesa = $('#mesa').value.trim();
    const data = $('#data').value;
    const hora = $('#hora').value;
    const observacoes = $('#observacoes').value.trim();

    if (!nome || !telefone || !pessoas || !data || !hora){
      msg.textContent = 'Preencha os campos obrigatórios.';
      msg.className = 'error';
      return;
    }

    const id = 'R'+Date.now().toString(36)+Math.random().toString(36).slice(2,7).toUpperCase();
    const carimbo = new Date().toISOString();
    const dataHoraISO = new Date(`${data}T${hora}:00`).toISOString();

    const payload = {
      ID: id,
      Carimbo: carimbo,
      Nome: nome,
      Email: email,
      Telefone: telefone,
      Pessoas: pessoas,
      Mesa: mesa,
      DataHora: dataHoraISO,
      Status: 'Pendente',
      Observacoes: observacoes
    };

    btn.disabled = true; btn.textContent = 'Enviando…';
    try{
      const r = await fetch(CONFIG.SHEET_ENDPOINT,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(payload)
      });
      if (r.ok){
        msg.innerHTML = `<div class="success"><b>Reserva enviada!</b><br>Protocolo: <b>${id}</b>.</div>`;
        $('#formReserva').reset();
      }else{
        throw new Error('Falha ao enviar');
      }
    }catch(err){
      console.error(err);
      msg.innerHTML = `<div class="error">Não foi possível enviar sua reserva agora.</div>`;
    }finally{
      btn.disabled = false; btn.textContent = 'Reservar agora';
    }
  });
</script>
</body>
</html>
